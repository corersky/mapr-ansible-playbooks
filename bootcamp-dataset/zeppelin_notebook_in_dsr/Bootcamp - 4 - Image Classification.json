{"paragraphs":[{"title":"Lesson 8","text":"In this lesson you will be querying the MapR-DB replicated table using Apache Drill in this Apache Zeppelin notebook.\n\nThe notebook consists out of a number of queries that reflect business questions about the classified image. The initial query constructs a Apache Drill view that is referenced in later parts of this notebook so therefore, it is important to perform that query first before continuing with the other queries.","user":"mapr","dateUpdated":"2018-03-01T15:01:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765617_-1762225776","id":"20180111-080459_1654389256","dateCreated":"2018-03-01T14:49:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:7610"},{"title":"Prerequisite","text":"%drill\nALTER SYSTEM SET `planner.enable_decimal_data_type` = true;","user":"mapr","dateUpdated":"2018-03-01T15:01:25+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765623_-1762995274","id":"20180117-145220_379170761","dateCreated":"2018-03-01T14:49:25+0000","dateStarted":"2018-03-01T15:01:25+0000","dateFinished":"2018-03-01T15:01:25+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7611"},{"title":"Create a View for querying the classified data","text":"%drill\nCreate or Replace View \n    dfs.root.`/remote-image-classification/remote-image-output-table_view` as select\n    *\n    from\n    (\n    select\n    Image\n    , Cast(`Year` as Decimal(4,0)) as `Year`\n    , Cast(`Month` as Decimal(2,0)) as `Month`\n    , Cast(`Day` as Decimal(2,0)) as `Day`\n    , Cast(`HourMinute` as Decimal(4,0)) as `HourMinute`\n    , Cast(`Hour` as Decimal(2,0)) as `Hour`\n    , Cast(`Minute` as Decimal(2,0)) as `Minute`\n    , Cast(Concat(`Hour`, ':', `Minute`, ':', '00') as Time) as `Time`\n    , Label\n    , Confidence\n    , TopLeftX\n    , TopLeftY\n    , BottomRightX\n    , BottomRightY\n    , 1 as Counter\n    from\n        (select \n        t.Image as Image\n        , SUBSTR(t.Image, 8, 4) `Year`\n        , SUBSTR(t.Image, 12, 2) `Month`\n        , SUBSTR(t.Image, 14, 2) `Day`\n        , SUBSTR(t.Image, 17, 4) `HourMinute`\n        , SUBSTR(t.Image, 17, 2) `Hour`\n        , SUBSTR(t.Image, 19, 2) `Minute`\n        , SUBSTR(t.Image, 17, 6) `Time`\n        , t.objects.label Label\n        , t.objects.confidence Confidence\n        , t.objects.topleft.x TopLeftX\n        , t.objects.topleft.y TopLeftY\n        , t.objects.bottomright.x BottomRightX\n        , t.objects.bottomright.y BottomRightY \n    from (select _Id as Image, flatten(objects) as objects from dfs.root.`/remote-image-classification/remote-image-output-table`) t))\n","user":"mapr","dateUpdated":"2018-03-01T15:01:25+0000","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765623_-1762995274","id":"20180124-131306_1606414073","dateCreated":"2018-03-01T14:49:25+0000","dateStarted":"2018-03-01T15:01:25+0000","dateFinished":"2018-03-01T15:01:26+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7612"},{"title":"Count the total number of objects in the dataset.","text":"%drill\nselect count(Distinct Image) as `Files`,  sum(Counter) as `Objects` from dfs.root.`/remote-image-classification/remote-image-output-table_view`","user":"mapr","dateUpdated":"2018-03-01T15:01:25+0000","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765624_-1764919018","id":"20180111-081054_1882856626","dateCreated":"2018-03-01T14:49:25+0000","dateStarted":"2018-03-01T15:01:25+0000","dateFinished":"2018-03-01T15:01:26+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7613"},{"text":"%drill\nselect *  from dfs.root.`/remote-image-classification/remote-image-output-table_view` limit 10","user":"mapr","dateUpdated":"2018-03-01T15:01:25+0000","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765625_-1765303767","id":"20180111-123744_907442680","dateCreated":"2018-03-01T14:49:25+0000","dateStarted":"2018-03-01T15:01:26+0000","dateFinished":"2018-03-01T15:01:29+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7614"},{"title":"Which are the Top 5 objects that have been classified?","text":"%drill\nselect Label, sum(counter) Number from dfs.root.`/remote-image-classification/remote-image-output-table_view` group by Label order by 2 desc Limit 5\n","user":"mapr","dateUpdated":"2018-03-01T15:01:25+0000","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765626_-1764149521","id":"20180111-081210_1820375252","dateCreated":"2018-03-01T14:49:25+0000","dateStarted":"2018-03-01T15:01:26+0000","dateFinished":"2018-03-01T15:01:27+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7615"},{"title":"What are the Top 3 images with the most objects classified","text":"%drill\nselect  Image, sum(counter) Number from dfs.root.`/remote-image-classification/remote-image-output-table_view` group by Image order by 2 desc LIMIT 3","user":"mapr","dateUpdated":"2018-03-01T15:01:25+0000","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765627_-1764534269","id":"20180111-093758_1983859732","dateCreated":"2018-03-01T14:49:25+0000","dateStarted":"2018-03-01T15:01:26+0000","dateFinished":"2018-03-01T15:01:27+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7616"},{"title":"What are the Labels for the Top 5 images with the most objects classified?","text":"%drill\nselect Label, sum(`Number`) as `Number` from\n  (select Image, Label, sum(Counter) as `Number` from  dfs.root.`/remote-image-classification/remote-image-output-table_view` \n   where Image in \n    (select Image from  \n      (select Image, sum(Counter) from dfs.root.`/remote-image-classification/remote-image-output-table_view` \n      Group by Image Order By 2 Desc limit 5) \n    ) group by Image, Label)\nGroup by Label Order By `Number` Desc","user":"mapr","dateUpdated":"2018-03-01T15:01:25+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765627_-1764534269","id":"20180111-201010_171634294","dateCreated":"2018-03-01T14:49:25+0000","dateStarted":"2018-03-01T15:01:26+0000","dateFinished":"2018-03-01T15:01:29+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7617"},{"title":"What is the image with the least classified objects? When was it taken? And what are the objects identified for this image?","text":"%drill\nselect Image,`Time`, Label, sum(Counter) as `Number` from  dfs.root.`/remote-image-classification/remote-image-output-table_view` \nwhere Image in\n    (select Image from \n        (select Image, sum(Counter) Number from dfs.root.`/remote-image-classification/remote-image-output-table_view` group by Image order by 2 asc LIMIT 1))\nGroup By Image, `Time`, Label Order By 4 Desc","user":"mapr","dateUpdated":"2018-03-01T15:01:26+0000","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765628_-1766458014","id":"20180111-090834_419928583","dateCreated":"2018-03-01T14:49:25+0000","dateStarted":"2018-03-01T15:01:27+0000","dateFinished":"2018-03-01T15:01:30+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7618"},{"title":"What is  the spread of the number of images classified per hour?","text":"%drill\nselect distinct(Image), `Hour`, count(Distinct Image) as `Number` from dfs.root.`/remote-image-classification/remote-image-output-table_view`  group by Image, `Hour` order by 1 Asc\n","user":"mapr","dateUpdated":"2018-03-01T15:01:26+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"multiBarChart":{}},"commonSetting":{},"keys":[{"name":"Hour","index":1,"aggr":"sum"}],"groups":[],"values":[{"name":"Number","index":2,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765628_-1766458014","id":"20180112-073325_1781275764","dateCreated":"2018-03-01T14:49:25+0000","dateStarted":"2018-03-01T15:01:28+0000","dateFinished":"2018-03-01T15:01:30+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7619"},{"title":"What is the spread of people in the room over time?","text":"%drill\nselect  distinct(`Time`), count(Label) as `Total` from dfs.root.`/remote-image-classification/remote-image-output-table_view` Where Label = 'person' group by `Time` order by 1 asc","user":"mapr","dateUpdated":"2018-03-01T15:01:26+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"lineChart","height":300,"optionOpen":false,"setting":{"multiBarChart":{},"lineChart":{"lineWithFocus":false,"forceY":false}},"commonSetting":{},"keys":[{"name":"Time","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"Total","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765629_-1766842763","id":"20180124-093641_1999771619","dateCreated":"2018-03-01T14:49:25+0000","dateStarted":"2018-03-01T15:01:28+0000","dateFinished":"2018-03-01T15:01:30+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7620"},{"title":"Identify images that could be incorrectly classified and use the global namespace to identify the image on the remote cluster - Part 1","text":"%drill\nselect Label, sum(counter) Number from dfs.root.`/remote-image-classification/remote-image-output-table_view` group by Label order by 2 desc\n","user":"mapr","dateUpdated":"2018-03-01T15:01:26+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765629_-1766842763","id":"20180124-210701_185709304","dateCreated":"2018-03-01T14:49:25+0000","dateStarted":"2018-03-01T15:01:29+0000","dateFinished":"2018-03-01T15:01:30+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7621"},{"title":"Identify images that could be incorrectly classified and use the global namespace to identify the image on the remote cluster - Part 2","text":"%drill\nselect Image, Label from dfs.root.`/remote-image-classification/remote-image-output-table_view` where Label = 'dog'\n\n","user":"mapr","dateUpdated":"2018-03-01T15:01:26+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765629_-1766842763","id":"20180130-095626_628234853","dateCreated":"2018-03-01T14:49:25+0000","dateStarted":"2018-03-01T15:01:29+0000","dateFinished":"2018-03-01T15:01:30+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7622"},{"text":"%drill\n","user":"mapr","dateUpdated":"2018-03-01T15:01:26+0000","config":{"colWidth":12,"editorMode":"ace/mode/sql","results":{},"enabled":true,"editorSetting":{"language":"sql","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1519915765630_-1765688516","id":"20180130-100434_251905939","dateCreated":"2018-03-01T14:49:25+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7623"}],"name":"ImageClassification","id":"2DA72D75C","angularObjects":{"2D62CT1DQ:shared_process":[],"2D8G9D73K:shared_process":[],"2D8TU15YC:shared_process":[],"2D54WCWGC:shared_process":[],"2D8Y76AD9:shared_process":[],"2D6JJ7UCG:shared_process":[],"2D7E3UHR8:shared_process":[],"2D6MQMUC3:shared_process":[],"2D8GGRMWP:shared_process":[],"2D74ABFTT:shared_process":[],"2D8VDEMU6:shared_process":[],"2D7ZF9Y4G:shared_process":[],"2D66UHCDC:shared_process":[],"2D6VGDAVF:shared_process":[],"2D8FRBDG6:shared_process":[],"2D5JUM6FT:shared_process":[],"2D6QN42QF:shared_process":[],"2D5B7AAEJ:shared_process":[],"2D5ZB77XQ:shared_process":[],"2D5AKDJ31:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}