---
  - name: Clone mapr-pacc-minio-docker repository
    git:
      repo: https://github.com/mkieboom/mapr-pacc-minio-docker
      dest: ~/mapr-pacc-minio-docker/

  - name: Build the Docker image
    docker_image:
      path: ~/mapr-pacc-minio-docker/
      name: mkieboom/mapr-pacc-minio-docker

  - name: Remove the mapr-pacc-minio-docker container if it is already running
    docker_container:
      image: mkieboom/mapr-pacc-minio-docker
      name: mapr-pacc-minio-docker
      restart_policy: always
      state: present
      recreate: yes
      force_kill: yes

  - name: Launch the mapr-pacc-minio-docker container
    docker_container:
      image: mkieboom/mapr-pacc-minio-docker
      name: mapr-pacc-minio-docker
      restart_policy: always
      state: started
      recreate: yes
      force_kill: yes
      env:
        MAPR_CLUSTER=demo.mapr.com
        MAPR_CLDB_HOSTS={{ansible_default_ipv4.address}}
        MAPR_CONTAINER_USER=mapr
        MAPR_CONTAINER_GROUP=mapr
        MAPR_CONTAINER_UID=5000
        MAPR_CONTAINER_GID=5000
        MAPR_MOUNT_PATH=/mapr
        MINIO_ACCESS_KEY=myminioaccesskey
        MINIO_SECRET_KEY=myminiosecretkey
      devices:
        - "/dev/fuse"
      capabilities:
        - SYS_ADMIN
        - SYS_RESOURCE
      ports:
        - "9000:9000"
