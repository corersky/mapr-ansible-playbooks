---
  # - name: Clone mapr-pacc-minio-docker repository
  #   git:
  #     repo: https://github.com/mkieboom/mapr-pacc-minio-docker
  #     dest: ~/mapr-pacc-minio-docker/

  # - name: Build the Docker image
  #   docker_image:
  #     path: ~/mapr-pacc-minio-docker/
  #     name: mkieboom/mapr-pacc-minio-docker

  # Install the Minio Docker container
  - name: Remove the mapr-pacc-minio-docker container if it is already running
    docker_container:
      image: mkieboom/mapr-pacc-minio-docker
      name: mapr-pacc-minio-docker
      restart_policy: always
      state: present
      recreate: yes
      force_kill: yes

  - name: Launch the mapr-pacc-minio-docker container
    docker_container:
      image: mkieboom/mapr-pacc-minio-docker
      name: mapr-pacc-minio-docker
      restart_policy: always
      state: started
      recreate: yes
      force_kill: yes
      env:
        MAPR_CLUSTER={{cluster_name}}
        MAPR_CLDB_HOSTS={{ansible_default_ipv4.address}}
        MAPR_CONTAINER_USER={{mapr_user}}
        MAPR_CONTAINER_GROUP={{mapr_group}}
        MAPR_CONTAINER_UID={{mapr_user_uid}}
        MAPR_CONTAINER_GID={{mapr_group_gid}}
        MAPR_MOUNT_PATH=/mapr
        MINIO_ACCESS_KEY=myminioaccesskey
        MINIO_SECRET_KEY=myminiosecretkey
      devices:
        - "/dev/fuse"
      capabilities:
        - SYS_ADMIN
        - SYS_RESOURCE
      ports:
        - "9000:9000"


  # Install the Portainer Docker container
  - name: Remove the Portainer container if it is already running
    docker_container:
      image: portainer/portainer
      name: portainer
      restart_policy: always
      state: present
      recreate: yes
      force_kill: yes

  - name: Launch the Portainer container
    docker_container:
      image: portainer/portainer
      name: portainer
      restart_policy: always
      state: started
      recreate: yes
      force_kill: yes
      volumes:
        - "/var/run/docker.sock:/var/run/docker.sock"
        - "/portainer:/data"
      ports:
        - "9001:9000"


  # Install the Web-Filebrowser (elfinder) Docker container
  - name: Remove the Web-Filebrowser (elfinder) container if it is already running
    docker_container:
      image: ruediste/elfinder
      name: elfinder
      restart_policy: always
      state: present
      recreate: yes
      force_kill: yes

  - name: Launch the Web-Filebrowser (elfinder) container
    docker_container:
      image: ruediste/elfinder
      name: elfinder
      restart_policy: always
      state: started
      recreate: yes
      force_kill: yes
      volumes:
        - "/mapr/:/data"
      ports:
        - "8080:80"
